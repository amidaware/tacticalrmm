###################
#  CFG file info  #
###################

CFG_VERSION="8"


######################
#  Parent Functions  #
######################

# Main install function
mainInstall()
{
    # Repo info for Postegres and Mongo
    # InstallFunctions
    setInstallRepos;

    # Create usernames and passwords
    # User Input
    generateUsersAndPass;

    # This does... something
    # Misc functions
    cls;

    # Get host/domain info
    # User Input
    getHostAndDomainInfo;

    # Configure hosts file
    # Misc functions
    print_green 'Configuring Hosts file';
    # Network functions
    configHosts;

    # Certificate generation
    # Misc functions
    print_green 'Installing Certbot';
    # InstallFunctions
    installCertbot "$INSTALL_TYPE";

    # Install Nginx
    # Misc functions
    print_green 'Installing Nginx';
    # InstallFunctions
    installNginx "$INSTALL_TYPE";

    # Install NodeJS
    # Misc functions
    print_green 'Installing NodeJS';
    # InstallFunctions
    installNodeJS;

    # Install and enable MongoDB
    # Misc functions
    print_green 'Installing MongoDB';
    # InstallFunctions
    installMongo;

    # Install Python
    # Misc functions
    print_green "Installing Python ${PYTHON_VER}";
    # InstallFunctions
    installPython "$INSTALL_TYPE";

    # Installing Redis
    # Misc functions
    print_green 'Installing redis';
    # InstallFunctions
    installRedis;

    # Install and enable Postgresql
    # Misc functions
    print_green 'Installing postgresql';
    # InstallFunctions
    installPostgresql;

    # Postgres DB creation
    # Misc functions
    print_green 'Creating database for the rmm';
    # Database functions
    createPGDB;

    # Clone main repo
    # Misc functions
    print_green 'Cloning primary repo';
    # Misc functions
    clonePrimaryRepo "$INSTALL_TYPE" "$REPO_URL" "$BRANCH";
  
    # Clone scripts repo
    # Misc functions
    print_green 'Cloning community scripts repo';
    # Misc functions
    cloneScriptsRepo "$INSTALL_TYPE" "$SCRIPTS_REPO_URL";

    # Installing NATS
    # Misc functions
    print_green 'Installing NATS';
    # InstallFunctions
    installNats "$INSTALL_TYPE";

    # Install MeshCentral
    # Misc functions
    print_green 'Installing MeshCentral';
    # InstallFunctions
    installMeshCentral "$INSTALL_TYPE";
  
    # Create MeshCentral config
    # Misc functions
    print_green 'Generating MeshCentral Config';
    # Config and Service functions
    createMeshConfig;

    # Create local settings file
    # Misc functions
    print_green 'Generating Local Settings';
    # Config and Service functions
    createLocalSettings;

    # Install NATS-API and correct permissions
    # Misc functions
    print_green 'Installing NATS API';
    # InstallFunctions
    installNatsApi;

    # Install backend, configure primary admin user, setup admin 2fa
    # Misc functions
    print_green 'Installing the backend';
    # Config and Service functions
    configureBackend "$INSTALL_TYPE";

    # Create UWSGI config
    # Misc functions
    print_green 'Creating UWSGI configuration';
    # Config and Service functions
    createUwsgiConf;

    # Create RMM UWSGI systemd service
    # Misc functions
    print_green 'Creating UWSGI service';
    # Config and Service functions
    createUwsgiService;

    # Create Daphne systemd service
    # Misc functions
    print_green 'Creating Daphne service';
    # Config and Service functions
    createDaphneService;

    # Create NATS systemd service
    # Misc functions
    print_green 'Creating NATS service';
    # Config and Service functions
    createNatsService;

    # Create NATS-api systemd service
    # Misc functions
    print_green 'Creating NATS-API service';
    # Config and Service functions
    createNatsApiService;

    # Create Backend Nginx site config
    # Misc functions
    print_green 'Creating Backend Nginx config';
    # Config and Service functions
    createBackendNginxConf;

    # Create MeshCentral Nginx configuration
    # Misc functions
    print_green 'Creating MeshCentral Nginx config';
    # Config and Service functions
    createMeshNginxConf;

    # Enable Mesh and RMM sites
    sudo ln -s /etc/nginx/sites-available/rmm.conf /etc/nginx/sites-enabled/rmm.conf
    sudo ln -s /etc/nginx/sites-available/meshcentral.conf /etc/nginx/sites-enabled/meshcentral.conf

    # Create conf directory
    sudo mkdir /etc/conf.d

    # Create Celery systemd service
    # Misc functions
    print_green 'Creating Celery service';
    # Config and Service functions
    createCeleryService;

    # Configure Celery service
    # Misc functions
    print_green 'Creating Celery config';
    # Config and Service functions
    createCeleryConf;

    # Create CeleryBeat systemd service
    # Misc functions
    print_green 'Creating CeleryBeat service';
    # Config and Service functions
    createCeleryBeatService;

    # Correct conf dir ownership
    sudo chown "${USER}:${USER}" -R /etc/conf.d/

    # Create MeshCentral systemd service
    # Misc functions
    print_green 'Creating MeshCentral service';
    # Config and Service functions
    createMeshCentralService;

    # Update services info
    sudo systemctl daemon-reload

    # Verify and correct permissions
    if [ -d ~/.npm ]; then
        sudo chown -R "${USER}:${GROUP}" ~/.npm
    fi

    if [ -d ~/.config ]; then
        sudo chown -R "${USER}:${GROUP}" ~/.config
    fi

    # Install frontend
    # Misc functions
    print_green 'Installing the frontend';
    # InstallFunctions
    installFrontEnd "$INSTALL_TYPE" "$FRONTEND_URL";

    # Set front end Nginx config and enable
    # Misc functions
    print_green 'Creating Frontend Nginx config';
    # Config and Service functions
    createFrontendNginxConf;

    # Enable Frontend site
    sudo ln -s /etc/nginx/sites-available/frontend.conf /etc/nginx/sites-enabled/frontend.conf

    # Enable RMM, Daphne, Celery, and Nginx services
    # Misc functions
    print_green 'Enabling Services';

    for i in rmm.service daphne.service celery.service celerybeat.service nginx
    do
        sudo systemctl enable ${i}
        sudo systemctl stop ${i}
        sudo systemctl start ${i}
    done
    sleep 5

    # Enable MeshCentral service
    # Misc functions
    print_green 'Starting meshcentral and waiting for it to install plugins';
    # Config and Service functions
    enableMeshService;

    # Generating MeshCentral key
    # Misc functions
    print_green 'Generating meshcentral login token key';
    # Config and Service functions
    generateMeshToken;

    # Configuring MeshCentral admin user and device group, restart service
    # Misc functions
    print_green 'Creating meshcentral account and group';
    # Config and Service functions
    configMeshUserGroup;

    # Enable and configure NATS service
    # Misc functions
    print_green 'Starting NATS service';
    # Config and Service functions
    enableNatsService;

    # Disable django admin
    sed -i 's/ADMIN_ENABLED = True/ADMIN_ENABLED = False/g' /rmm/api/tacticalrmm/tacticalrmm/local_settings.py

    # Restart core services
    # Misc functions
    print_green 'Restarting services';

    for i in rmm.service daphne.service celery.service celerybeat.service
    do
        sudo systemctl stop ${i}
        sudo systemctl start ${i}
    done

    # Yay, we're done!
    # Misc functions
    print_yellow "Installation complete!";
    echo -e "${YELLOW} Access your rmm at: ${GREEN}https://${frontenddomain}${NC}\n"
    echo -e "${YELLOW} Django admin url (disabled by default): ${GREEN}https://${rmmdomain}/${ADMINURL}/${NC}\n"
    echo -e "${YELLOW} MeshCentral username: ${GREEN}${meshusername}${NC}"
    echo -e "${YELLOW} MeshCentral password: ${GREEN}${MESHPASSWD}${NC}\n"

    if [ "$BEHIND_NAT" = true ]; then
        echo -e  "${YELLOW} Read below if your router does NOT support Hairpin NAT:${NC}\n"
        echo -e "${GREEN} If you will be accessing the web interface of the RMM from the same LAN as this server,\nyou'll need to make sure your 3 subdomains resolve to ${IPV4}${NC}\n"
        echo -e "${GREEN} This also applies to any agents that will be on the same local network as the rmm.${NC}\n"
        echo -e "${GREEN} You'll also need to setup port forwarding in your router on port 443.${NC}\n"
    fi
    # Misc functions
    print_yellow "Please refer to the github README for next steps.";

    return
}

# Update function
updateTRMM()
{
    # Check if user is same as during installation
    # UpdateRestoreFunctions
    checkSameUser "$INSTALL_TYPE";

    # Get current release version and check if update is necessary
    # UpdateRestoreFunctions
    checkIfUpdate;

    # Get current versions of necessary included apps
    # UpdateRestoreFunctions
    checkAdditionalAppsVers;

    # Clear screen
    # Misc functions
    cls;

    # Check CHECK_NATS_LIMITNOFILE, whatever that means
    # UpdateRestoreFunctions
    checkNatsLimitNoFile;

    # Check Nginx config
    # InstallFunctions
    installNginx "updatepart1";

    # Stop services
    for i in nginx nats-api nats rmm daphne celery celerybeat
    do
        echo -e "${GREEN} Stopping ${i} service...${NC}"
        sudo systemctl stop "${i}"
    done

    # Rebuild uwsgi config
    rm -f /rmm/api/tacticalrmm/app.ini
    # Config and Service functions
    createUwsgiConf;

    # Check if Python is up to date, if not, update
    # InstallFunctions
    installPython "$INSTALL_TYPE";

    # Check if NATS is up to date, if not, update
    # InstallFunctions
    installNats "$INSTALL_TYPE";

    # This does stuff
    if [ -d ~/.npm ]; then
        sudo rm -rf ~/.npm
    fi

    if [ -d ~/.cache ]; then
        sudo rm -rf ~/.cache
    fi

    if [ -d ~/.config ]; then
        sudo chown -R "${USER}:${GROUP}" ~/.config
    fi

    # Check NodeJS version, update if needed and update MeshCentral
    # Misc functions
    print_green 'Updating NodeJS';
    # InstallFunctions
    installNodeJS "$INSTALL_TYPE";

    # Pull domain info from existing Nginx confs
    # Misc functions
    getExistingDomainInfo;

    # Update from main repo
    # Misc functions
    print_green 'Cloning primary repo';
    # Misc functions
    clonePrimaryRepo "$INSTALL_TYPE" "$REPO_URL" "$BRANCH";

    # Update from community-scripts repo
    # Misc functions
    print_green 'Cloning community scripts repo';
    # Misc functions
    cloneScriptsRepo "$INSTALL_TYPE" "$SCRIPTS_REPO_URL";

    # Apply updated Ownership and perms
    sudo chown "${USER}:${USER}" -R /rmm
    sudo chown "${USER}:${USER}" -R ${SCRIPTS_DIR}
    sudo chown "${USER}:${USER}" /var/log/celery
    sudo chown "${USER}:${USER}" -R /etc/conf.d/

    # Check additional Nginx settings and update
    # InstallFunctions
    installNginx "updatepart2";

    # Update Nginx conf files
    # Config and Service functions
    createMeshNginxConf;
    # Config and Service functions
    createFrontendNginxConf;
    # Config and Service functions
    createBackendNginxConf;

    # Reconfigure backend
    # Config and Service functions
    createCeleryConf;
    # Config and Service functions
    configureBackend "$INSTALL_TYPE";

    # Disable Redis append only
    # UpdateRestoreFunctions
    turnOffRedisAppendOnly;

    # Update Frontend
    # InstallFunctions
    installFrontEnd "$INSTALL_TYPE" "$FRONTEND_URL";

    # Start services
    for i in nats nats-api rmm daphne celery celerybeat nginx
    do
        echo -e "${GREEN} Starting ${i} service${NC}"
        sudo systemctl start "${i}"
    done
    sleep 1

    # Push agent updates
    /rmm/api/env/bin/python /rmm/api/tacticalrmm/manage.py update_agents

    # Update MeshCentral if necessary
    updateMeshCentral;
    # Config and Service functions
    createMeshConfig;
    # Config and Service functions
    enableMeshService "$INSTALL_TYPE";

    # Cleanup
    rm -f $TMP_SETTINGS

    # Bye-bye
    # Misc functions
    print_green "Update finished!";

    return
}

# Backup Function
backupTRMM()
{
    # Pull Postgres info
    POSTGRES_USER=$(grep -w USER /rmm/api/tacticalrmm/tacticalrmm/local_settings.py | sed 's/^.*: //' | sed 's/.//' | sed -r 's/.{2}$//')
    POSTGRES_PW=$(grep -w PASSWORD /rmm/api/tacticalrmm/tacticalrmm/local_settings.py | sed 's/^.*: //' | sed 's/.//' | sed -r 's/.{2}$//')

    # Check if rmmbackup folder exists, if not create it
    if [ ! -d /rmmbackups ]; then
        sudo mkdir /rmmbackups
        sudo chown "${USER}:${USER}" /rmmbackups
    fi

    # Remove old MeshCentral backups
    if [ -d /meshcentral/meshcentral-backup ]; then
        rm -rf /meshcentral/meshcentral-backup/*
    fi

    # Remove old MeshCentral DB backups
    if [ -d /meshcentral/meshcentral-coredumps ]; then
        rm -f /meshcentral/meshcentral-coredumps/*
    fi

    # Set info for backup and folders
    dt_now=$(date '+%Y_%m_%d__%H_%M_%S')
    tmp_dir=$(mktemp -d -t tacticalrmm-XXXXXXXXXXXXXXXXXXXXX)
    sysd="/etc/systemd/system"

    # Create temp backup subdirectories
    mkdir -p ${tmp_dir}/meshcentral/mongo
    mkdir ${tmp_dir}/postgres
    mkdir ${tmp_dir}/certs
    mkdir ${tmp_dir}/nginx
    mkdir ${tmp_dir}/systemd
    mkdir ${tmp_dir}/rmm
    mkdir ${tmp_dir}/confd

    # Dump Postgres database
    pg_dump --dbname=postgresql://"${POSTGRES_USER}":"${POSTGRES_PW}"@127.0.0.1:5432/tacticalrmm | gzip -9 > ${tmp_dir}/postgres/db-${dt_now}.psql.gz

    # Backup Mesh stuff
    tar -czvf ${tmp_dir}/meshcentral/mesh.tar.gz --exclude=/meshcentral/node_modules /meshcentral
    mongodump --gzip --out=${tmp_dir}/meshcentral/mongo

    # Backup certs
    sudo tar -czvf ${tmp_dir}/certs/etc-letsencrypt.tar.gz -C /etc/letsencrypt .

    # Backup Nginx configs
    sudo tar -czvf ${tmp_dir}/nginx/etc-nginx.tar.gz -C /etc/nginx .

    # Backup other config files
    sudo tar -czvf ${tmp_dir}/confd/etc-confd.tar.gz -C /etc/conf.d .

    # Copy service files
    sudo cp ${sysd}/rmm.service ${sysd}/celery.service ${sysd}/celerybeat.service ${sysd}/meshcentral.service ${sysd}/nats.service ${sysd}/daphne.service ${tmp_dir}/systemd/
    if [ -f "${sysd}/nats-api.service" ]; then
        sudo cp ${sysd}/nats-api.service ${tmp_dir}/systemd/
    fi

    cat /rmm/api/tacticalrmm/tacticalrmm/private/log/django_debug.log | gzip -9 > ${tmp_dir}/rmm/debug.log.gz
    cp /rmm/api/tacticalrmm/tacticalrmm/local_settings.py ${tmp_dir}/rmm/

    tar -cf /rmmbackups/rmm-backup-${dt_now}.tar -C ${tmp_dir} .

    # Remove temp files/folders
    rm -rf ${tmp_dir}
    # Misc functions
    print_green "Backup saved to /rmmbackups/rmm-backup-${dt_now}.tar";

    return
}

# Restore T-RMM
restoreTRMM()
{
    # Repo info for Postegres and Mongo
    # InstallFunctions
    setInstallRepos;

    # Get backup file location
    # UpdateRestoreFunctions
    getBackupFileLocation;

    # Extract backup
    # UpdateRestoreFunctions
    extractBackup "$backuppath";

    # Check if original user
    # UpdateRestoreFunctions
    checkSameUser "$INSTALL_TYPE";

    # Install NodeJS
    # Misc functions
    print_green 'Installing NodeJS';
    # InstallFunctions
    installNodeJS;

    # Install Nginx and restore Nginx configuration
    # Misc functions
    print_green 'Installing Nginx and restoring configuration';
    # InstallFunctions
    installNginx "$INSTALL_TYPE";

    # Restore hosts config
    # Network functions
    configHosts;

    # Restore Certbot
    # Misc functions
    print_green 'Installing Certbot';
    # InstallFunctions
    installCertbot "$INSTALL_TYPE";

    # Restoring existing certs
    # Misc functions
    print_green 'Restoring certs';

    sudo rm -rf /etc/letsencrypt
    sudo mkdir /etc/letsencrypt
    sudo tar -xzf $tmp_dir/certs/etc-letsencrypt.tar.gz -C /etc/letsencrypt

    # Recreate Nginx conf files
    # Config and Service functions
    createMeshNginxConf;
    # Config and Service functions
    createFrontendNginxConf;
    # Config and Service functions
    createBackendNginxConf;

    # Restore Celery configs
    # Misc functions
    print_green 'Restoring celery configs';

    sudo mkdir /etc/conf.d
    sudo tar -xzf $tmp_dir/confd/etc-confd.tar.gz -C /etc/conf.d
    sudo chown "${USER}:${USER}" -R /etc/conf.d

    # Restoring services
    # Misc functions
    print_green 'Restoring systemd services';

    sudo cp $tmp_dir/systemd/* /etc/systemd/system/
    sudo systemctl daemon-reload

    # Install Python
    # Misc functions
    print_green "Installing Python ${PYTHON_VER}";
    # InstallFunctions
    installPython;

    # Installing Redis
    # Misc functions
    print_green 'Installing redis';
    # InstallFunctions
    installRedis;

    # Install and enable Postgresql
    # Misc functions
    print_green 'Installing postgresql';
    # InstallFunctions
    installPostgresql;

    # Install and enable MongoDB
    # Misc functions
    print_green 'Installing MongoDB';
    # InstallFunctions
    installMongo;

    # Restore Mongo database
    # Misc functions
    print_green 'Restoring MongoDB';
    mongorestore --gzip $tmp_dir/meshcentral/mongo

    # Clone main repo
    # Misc functions
    print_green 'Cloning primary repo';
    # Misc functions
    clonePrimaryRepo "$INSTALL_TYPE" "$REPO_URL" "$BRANCH";

    # Clone scripts repo
    # Misc functions
    print_green 'Cloning community scripts repo';
    # Misc functions
    cloneScriptsRepo "$INSTALL_TYPE" "$SCRIPTS_REPO_URL";

    # Installing NATS
    # Misc functions
    print_green 'Installing NATS';
    # InstallFunctions
    installNats "$INSTALL_TYPE";

    # Restore MeshCentral
    # Misc functions
    print_green 'Restoring MeshCentral';
    # InstallFunctions
    installMeshCentral "$INSTALL_TYPE";

    # Restore UWSGI
    # Misc functions
    print_green 'Restoring UWSGI configuration';
    # Config and Service functions
    createUwsgiConf;

    # Restoring other misc stuff
    cp $tmp_dir/rmm/local_settings.py /rmm/api/tacticalrmm/tacticalrmm/
    cp $tmp_dir/rmm/env /rmm/web/.env
    gzip -d $tmp_dir/rmm/debug.log.gz
    cp $tmp_dir/rmm/django_debug.log /rmm/api/tacticalrmm/tacticalrmm/private/log/

    # Install NATS-API
    # Misc functions
    print_green 'Installing NATS API';
    # InstallFunctions
    installNatsApi;

    # Restore Postgres database
    # Misc functions
    print_green 'Restoring the Postgres database';

    pgusername="$(grep -w USER /rmm/api/tacticalrmm/tacticalrmm/local_settings.py | sed 's/^.*: //' | sed 's/.//' | sed -r 's/.{2}$//')"
    pgpw="$(grep -w PASSWORD /rmm/api/tacticalrmm/tacticalrmm/local_settings.py | sed 's/^.*: //' | sed 's/.//' | sed -r 's/.{2}$//')"
    
    sudo -u postgres psql -c "DROP DATABASE IF EXISTS tacticalrmm"
    # Database functions
    createPGDB;

    gzip -d $tmp_dir/postgres/*.psql.gz
    PGPASSWORD="${pgpw} psql -h localhost -U ${pgusername} -d tacticalrmm -f $tmp_dir/postgres/db*.psql"

    # Restore Backend
    # Misc functions
    print_green 'Restoring the backend';
    # Config and Service functions
    configureBackend "$INSTALL_TYPE";

    # Start NATS
    # Misc functions
    print_green 'Start NATS';
    sudo systemctl enable nats.service
    sudo systemctl start nats.service

    # Install frontend
    # Misc functions
    print_green 'Installing the frontend';
    # InstallFunctions
    installFrontEnd;

    # reset perms
    sudo chown "${USER}:${USER}" -R /rmm
    sudo chown "${USER}:${USER}" /var/log/celery
    sudo chown "${USER}:${USER}" -R /etc/conf.d/
    sudo chown -R "${USER}:${GROUP}" /home/"${USER}"/.npm
    sudo chown -R "${USER}:${GROUP}" /home/"${USER}"/.config
    sudo chown -R "${USER}:${GROUP}" /home/"${USER}"/.cache

    # Update services info
    sudo systemctl daemon-reload

    # Enable RMM, Daphne, Celery, Nats-api, and Nginx services
    # Misc functions
    print_green 'Enabling Services';

    for i in celery.service celerybeat.service rmm.service daphne.service nats-api.service nginx
    do
        sudo systemctl enable ${i}
        sudo systemctl stop ${i}
        sudo systemctl start ${i}
    done
    sleep 5

    # Start MeshCentral
    # Misc functions
    print_green 'Starting meshcentral';
    sudo systemctl enable meshcentral
    sudo systemctl start meshcentral

    # Done!!!!
    # Misc functions
    print_green 'Restore complete!';

    return
}

# Troubleshooting utility
troubleShoot()
{
    # Resolve Locally used DNS server
    locdns=$(resolvectl | grep 'Current DNS Server:' | cut -d: -f2 | awk '{ print $1}')

    # Get existing domain info
    if [ -f /etc/nginx/sites-available/rmm.conf ] && [ -f /etc/nginx/sites-available/rmm.conf ] && [ -f /etc/nginx/sites-available/rmm.conf ]; then
        # Misc functions
        getExistingDomainInfo;
    else
        # User Input
        getHostAndDomainInfo "TS";
    fi

    # Verify domains are live
    # Troubleshooting functions
    pingDomain "$rmmdomain";
    pingDomain "$frontenddomain";
    pingDomain "$meshdomain";

    # Verify IPs
    echo -e "${GREEN} Checking IPs${NC}" | tee -a checklog.log
    echo -e "\n"
    # Troubleshooting functions
    checkIPisLive "$rmmdomain";
    remapiip="${reminputip}"
    checkIPisLive "$frontenddomain";
    checkIPisLive "$meshdomain";

    # Get services status
    # Troubleshooting functions
    readServicesStatus;

    # Verify services active
    # Troubleshooting functions
    checkIfServiceActive "$rmmstatus" "RMM Service";
    checkIfServiceActive "$daphnestatus" "Daphne Service";
    checkIfServiceActive "$celerystatus" "Celery Service";
    checkIfServiceActive "$celerybeatstatus" "CeleryBeat Service";
    checkIfServiceActive "$nginxstatus" "Nginx Service";
    checkIfServiceActive "$natsstatus" "NATS Service";
    checkIfServiceActive "$natsapistatus" "NATS-API Service";
    checkIfServiceActive "$meshcentralstatus" "MeshCentral Service";
    checkIfServiceActive "$mongodstatus" "MongoD Service";
    checkIfServiceActive "$postgresqlstatus" "Postgresql Service";
    checkIfServiceActive "$redisserverstatus" "Redis-Server Service";

    # Get WAN IP
    wanip=$(dig @resolver4.opendns.com myip.opendns.com +short)
    echo -e "${GREEN} WAN IP is $wanip.${NC}" | tee -a checklog.log
    echo -e "\n"

    # Check if ports are open
    # Troubleshooting functions
    isPortOpen "4222" "NATS";
    isPortOpen "80" "HTTP";
    isPortOpen "443" "HTTPS";
    
    # Checking Proxy
    # Troubleshooting functions
    checkProxy;

    # Check for valid cert
    # Troubleshooting functions
    checkIfCertIsValid;

    # Generate log summary
    echo -e "${GREEN} Getting summary output of logs.${NC}" | tee -a checklog.log
    echo -e "\n"

    tail /rmm/api/tacticalrmm/tacticalrmm/private/log/django_debug.log  | tee -a checklog.log
	echo -e "\n"
    tail /rmm/api/tacticalrmm/tacticalrmm/private/log/error.log  | tee -a checklog.log
	echo -e "\n"
    # Misc functions
    print_yellow "You will have a log file called checklog.log in the directory you ran this script from.";

    return
}